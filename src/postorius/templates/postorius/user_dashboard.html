<!doctype html>
<!--
{# load url from future #} -->
{% load i18n %}{% load staticfiles %}
{# extends postorius_base_template #}
{% load url from future %}
{% load i18n %}
<html><head>  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static 'postorius/css/chartist.min.css' %}">
  <link rel="stylesheet" href="{% static 'postorius/css/bootstrap-multiselect.css' %}">
  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script src="{% static 'postorius/js/libs/chartist.min.js' %}"></script>
  <script src="{% static 'postorius/js/libs/bootstrap-multiselect.js' %}"></script>

<style>
@import url(http://fonts.googleapis.com/css?family=Open+Sans:300,400,700);

@font-face {
	font-family: "Brandon Grotesque Bold";
	src: url("{% static 'postorius/fonts/brandon_grotesque_bold.ttf' %}") format("truetype");
}
@font-face {
	font-family: "Brandon Grotesque Light";
	src: url("{% static 'postorius/fonts/brandon_grotesque_light.ttf' %}") format("truetype");
}
::-webkit-scrollbar-track {
	border-radius: 0px;
	background-color: #FFFFFF;
}
::-webkit-scrollbar {
	width: 10px;
	background-color: #FFFFFF;
}
::-webkit-scrollbar-thumb {
	border-radius: 0px;
	background-color: #0A1123;
}
@-webkit-keyframes dashoffset-seven {
	0% {stroke-dashoffset: 7px;}
	100% {stroke-dashoffset: 0px;}
}
.tooltip {
	position: absolute;
	z-index: 1;
	padding: 5px;
	background: rgba(0, 0, 0, 0.3);
	opacity: 1;
	border-radius: 3px;
	text-align: center;
	pointer-events: none;
	color: white;
	transition: opacity .1s ease-out;
}
.tooltip.tooltip-hidden {
	opacity: 0;
}
.ct-chart .ct-series.ct-series-b .ct-line{
	stroke: #FF5D56;
	stroke-width: 3px;
	stroke-dasharray: 5px 2px;
	-webkit-animation: dashoffset-seven 300ms infinite linear;
}
.ct-chart .ct-series.ct-series-b .ct-point {
	stroke: #FF5D56;
}
.ct-chart .ct-series.ct-series-a .ct-line {
	stroke: #F1C40F;
	stroke-width: 2px;
	stroke-dasharray: 5px 2px;
	-webkit-animation: dashoffset-seven 200ms infinite linear;
}
.ct-chart .ct-series.ct-series-a .ct-point {
	stroke: #F1C40F;
}

.nav li a{
	-webkit-transition: .2s all;
		transition: .2s all;

}
.btn, button { 
	-webkit-transition: .2s all;
		transition: .2s all;
}
.bg-color_-1 {
	background-color:#EFFAFE !important;
}
.bg-color_0 {
	background-color:#DBE7FD !important;
}
.bg-color_1 {
	background-color:#9F84ED !important;
}
.bg-color_-2 {
	background-color:#FFFFFF !important;
}
.btn_-1 {
	border:1px solid #00BCD4;
	color: #00BCD4;
}
.btn_0 {
	border:1px solid  #0097A7;
	color:  #0097A7;
}
.btn_1 {
	border:1px solid #303F9F;
	color: #303F9F;
}
.btn_-2 {
	border:1px solid #3a3a3a;
	color: #3a3a3a;
}
.btn_1:hover, .btn_1:focus {
	border:1px solid #303F9F;
	background-color: #303F9F;
	color: #fff;
}
.btn_0:hover, .btn_0:focus {
	border:1px solid  #0097A7;
	background-color: #0097A7;
	color: #fff;
}

.btn_-1:hover, .btn_-1:focus {
	border:1px solid #00BCD4;
	background-color: #00BCD4;
	color: #fff;
}
.btn_-2:hover, .btn_-2:focus {
	background-color: #3a3a3a;
	border:1px solid #3a3a3a;
	color: #fff;
}
.dialog {
	position: absolute;
	text-align: center;
	padding:0px;
	background: #fff;
	border-radius: 4px;
	margin: 0px 0 4px 4px;
	display: inline-block;
	width: 27%;
	height: 27%;
	box-shadow: 2px 2px 5px 1px rgba(0,0,0,0.52);
}
.dialog:after, .dialog:before {
	bottom: 100%;
	border: solid transparent;
	content: " ";
	height: 0;
	width: 0;
	position: absolute;
	pointer-events: none;
}
.dialog:after {
	border-color: rgba(255, 255, 255, 0);
	border-bottom-color: #e5e5e5;
	border-width: 8px;
	left: 20%;
	margin-left: 15px;
}
.dialog:before {
	border-color: rgba(170, 170, 170, 0);
	border-width: 16px;
	left: 50%;
	margin-left: -16px;
}
.dialog .title {
	color: #fff;
	font-weight: bold;
	text-align: center;
	border: 1px solid #000;
	border-width: 0px 0px 1px 0px;
	margin-left: 0;
	margin-right: 0;
	padding: 8px 16px;
	background: #000;
	box-shadow: 2px 2px 5px 1px rgba(0,0,0,0.52);
	font-size: 16px;
	line-height:2em;
}
.parent-active {
	background-color:#EEEEEE;
}
.panel-heading, .panel-default {
	border-radius: 0px !important;
}
.panel {
	border-radius:0px !important;
	border:1px solid #0097A7;
}
.panel-title  a {
	font-size:1em;
}
.toggle-accordian:hover, 
.toggle-accordian:active, 
.toggle-accordian:focus {
	text-decoration: none;
	color:#3a3a3a;
	font-size:1em;
}

.panel-title  ul li:first-child {
	color:#3a3a3a;
	font-size:1em;
}

.made-on {
	color:#34373C;
	font-size:0.96em;
}
h3 {
	font-family: "Brandon Grotesque Light", sans-serif;
	font-weight: 500;
}
#holoid > a {
	border-radius:0px; !important
}
#task-container {
	float: left;
	height: 60%;
	width: 100%;
	overflow-y: auto; 
	overflow-x: visible;
}
#task-container::-webkit-scrollbar-track {
	border-radius: 0px;
	background-color: #F5F5F5;
}

#task-container::-webkit-scrollbar {
	width: 8px;
	background-color: #F5F5F5;
}

#task-container::-webkit-scrollbar-thumb {
	border-radius: 0px;
	background-color: #777;
}
#list-container {
	display:none;
	height:72%;
}
.i-tasks:before {
	background:white;
	padding: 5px;
	border: 1px solid;
	color:#FFC107;
}
.task-table > tbody > tr:first-child > td{ 
	border-top: none !important;
}
.table > tbody > tr:last-child > td {
	padding-bottom: 0px !important;
	margin-bottom:0px !important;
}
.panel_tasks .panel-collapse .panel-body{
	padding-bottom:0px !important;
}
.role-nav li.active > a {
	border-bottom:2px solid #000;
	background-color: inherit;
}
.role-nav li > a {
	border-radius:0px;
	color: #3a3a3a;
}
html, body {
	font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
	height:100%;
	font-weight: 500;

}
.navbar {
	background-color: #0A1123;
}
.nav-icon {
	color: #ffffff;
}
.navbar > .container-fluid > .navbar-header a{
color: #E4F1FE;
}
.navbar .navbar-nav > li > a{
color: #FFFFFF !important;
}
.navbar .navbar-nav > li > a:hover{
color: #E4F1FE !important;
}
</style>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>                        
			</button>
			<a class="navbar-brand" href="#">Mailman | Dashboard</a>
		</div>
		<div class="collapse navbar-collapse" id="myNavbar">
			<form id="global-search-form" class="navbar-form navbar-left" role="search" action="{% url 'user_dashboard' %}" method="POST" class="form-inline">{% csrf_token %}
				<div class="form-group">
					{{global_search.query_field}}
					<datalist id="global-result"></datalist>
					<label class="checkbox-inline">{{global_search.check_lists}}Lists</label>
					<label class="checkbox-inline">{{global_search.check_domains}}Domains</label>
					<label class="checkbox-inline">{{global_search.check_people}}People</label>
				</div>
		       </form>
			<ul class="nav navbar-nav">
				{% regroup tasks|dictsort:"task_type" by task_type as typed_tasks %}
				{% for each in typed_tasks %}
					{% if each.grouper == "subscription" %}
				<li><a href="#"><span class="nav-icon fa fa-lg fa-fw fa-user"></span><sup><span class="badge">{{each.list|length}}</span></sup> Subscription Requests</a></li>
					{% elif each.grouper == "moderation" %}
				<li><a href="#"><span class="nav-icon fa fa-lg fa-fw fa-envelope"></span><sup><span class="badge">{{each.list|length}}</span></sup> Held Messages</a></li>
					{% endif %}
				{% endfor %}
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
						<span class="glyphicon glyphicon-user"></span>  Welcome {{user.username}}, You have <span>{{tasks|length}}</span> Remaining Tasks
					</a>
					<ul class="dropdown-menu" role="menu">
						<li><a href="{% url 'list_index' %}"><i class="fa fa-envelope-o fa-fw"></i>&nbsp;{% trans "Lists" %}</a></li>
						{% if user.is_superuser %}
					        <li><a href="{% url 'domain_index' %}"><i class="fa fa-globe fa-fw"></i>&nbsp;{% trans "Domains" %}</a></li>
					        {% endif %}
					        <li><a href="{% url 'user_mailmansettings' %}"><i class="fa fa-gears"></i>&nbsp;{% trans "My Settings" %}</a></li>
						<li class="divider"></li>
						<li><a href="{% url 'user_logout' %}"><i class="fa fa-power-off fa-fw"></i>&nbsp;{% trans "Logout" %}</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
</nav>

     <div class="mm_main mm_canvas">
         {% if messages %}
             <ul class="mm_messages">
             {% for message in messages %}
                 <li class="alert {% if message.tags %} {{ message.tags }}{% endif %}">{{ message }}</li>
             {% endfor %}
             </ul>
         {% endif %}
         {% block main %}{% endblock main %}
     </div>


<div class="container widget" style="height:70%;width:33%;margin-top:8%;display:inline-block;border:1px solid;margin-left:12%; box-shadow: 5px 5px 5px #888888;">


	<h3 class="text-center">To-Do List</h3>
	<ul class="nav nav-tabs nav-justified" id="switcher" role="tablist">
		<li class="active" ><a id="task-view" href="#">Task Basis</a></li>
		<li><a id="list-view" href="#">List Basis</a></li>
	</ul>

		<div class="col-xs-4" style="width:100%;height:3.2em;">
			<form action="{% url 'user_dashboard' %}" method="POST" class="form-inline">{% csrf_token %}
				<div style="margin-top:1%;float:right;width:40%;" class="input-group">
	             			<span class="input-group-btn"><button class="btn btn-default fa fa-filter" type="submit"></button></span>
					{{search_form.search_tasks}}
				</div>
		       </form>
		</div>
	
		<div style="margin-bottom:0px;border-radius:0px;height:72%;" class="well" id="task-container">
			{% for task in tasks %}
			<div class="panel-group" id="accordian" role="tablist" aria-multiselectable="true">
			<div class="panel panel-default panel_tasks">
					{% if task.task_type == 'subscription'%} 
					<div class="panel-heading bg-color_{{task.priority}}" role="tab" id="heading_{{task.task_id}}">
						<div class="panel-title">
							<span style="float:left;" class="fa-lg"><i style="margin-top:25%;" class="i-tasks fa fa-user"></i></span>
							<ul style="list-style-type:none;">
								<li>{{ task }}</li><br />
								<li><span class="made-on">{{ task.made_on }}</span>&nbsp;&nbsp;
									<small>{% if task.priority == -1 %}[Low Priority]
										{% elif task.priority == 0 %}[Medium Priority]
									 	{% elif task.priority == 1 %}[High Priority]
									 	{% else %}[Priority Not Set]{% endif %}</small>&nbsp;
									<div class="btn-group set-priority">
										<span class="fa fa-lg fa-gear dropdown-toggle" data-toggle="dropdown" area-expanded="false" ></span>
										<span class="sr-only">Toggle Priority</span>
										<ul class="dropdown-menu" role="menu">
											<li role="presentation" class="dropdown-header">Task Priority Level</li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id 1 %}">High Priority</a></li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id 0 %}">Medium Priority</a></li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id -1 %}">Low Priority</a></li>
										</ul>
									</div>			
									<div style="float:right;" id="holoid" class="btn-group btn-group-sm" id="block" role="group">
										<a href="{% url 'handle_sub_task' task.list_id task.task_id 'accept' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Accept' %}</a>
										<a href="{% url 'handle_sub_task' task.list_id task.task_id 'reject' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Reject' %}</a>
										<a href="{% url 'handle_sub_task' task.list_id task.task_id 'discard' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Discard' %}</a>
									</div>
								</li>
							</ul>
						</div>
					</div>
					{% else %}
					<div class="panel-heading bg-color_{{task.priority}}" role="tab" id="heading_{{task.task_id}}">
						<div class="panel-title">
							<a class="toggle-accordian" data-toggle="collapse" data-parent="#accordion" href="#collapse_{{task.task_id}}" aria-expanded="true" aria-controls="collapse_{{task.task_id}}">
							<span style="float:left;" class="fa-lg"><i style="margin-top:25%;" class="i-tasks fa fa-envelope-o "></i></span>
							<ul style="list-style-type:none;">
								<li>{{ task }}</li></a><br />
								<li><span class="made-on">{{task.made_on}}</span>&nbsp;&nbsp;
				 					<small>	{% if task.priority == -1 %}[Low Priority]
								 	{% elif task.priority == 0 %}[Medium Priority]
								 	{% elif task.priority == 1 %}[High Priority]
								 	{% else %}[Priority Not Set]{% endif %}</small>&nbsp;
									<div class="btn-group set-priority">
										<span class="fa fa-lg fa-gear dropdown-toggle" data-toggle="dropdown" area-expanded="false" ></span>
										<span class="sr-only">Toggle Priority</span>
										<ul class="dropdown-menu" role="menu">
											<li role="presentation" class="dropdown-header">Set Priority Level</li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id 1 %}">High Priority</a></li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id 0 %}">Medium Priority</a></li>
											<li role="presentation" ><a class="menuitem" href="{% url 'set_task_priority' task.task_id -1 %}">Low Priority</a></li>
										</ul>
									</div>			
									<div style="float:right;" id="holoid" class="btn-group btn-group-sm" role="group" >
										<a href="{% url 'handle_mod_task' task.list_id task.task_id 'accept'%}" class="btn btn_{{task.priority}} btn-default">{% trans 'Accept' %}</a>
										<a href="{% url 'handle_mod_task' task.list_id task.task_id 'defer' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Defer' %}</a>
										<a href="{% url 'handle_mod_task' task.list_id task.task_id 'reject' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Reject' %}</a>
										<a href="{% url 'handle_mod_task' task.list_id task.task_id 'discard' %}" class="btn btn_{{task.priority}} btn-default">{% trans 'Discard' %}</a>
									</div>
								</li>
							</ul>
						</div>
					</div>
					<div id="collapse_{{task.task_id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading_{{task.task_id}}">
						<div class="panel-body">
							<table class="table task-table"><thead></thead>
								<tbody>
									<tr style="text-align:left;">
										<td>Subject: {{task.msg_subject}}</td>
									</tr>
									<tr style="text-align:left;"><td>- {{task.user_email|capfirst}}</td></tr>
									<tr>
										<td style="text-align:left;">{{task.msg_data|linebreaks|truncatewords:36}}<a href="#" style="float:right;" data-toggle="modal" data-target="#modal-{{task.task_id}}">View More</a></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					{% endif %}
				</div>
			</div>

			<!-- Modal -->
			<div class="modal fade" id="modal-{{task.task_id}}" tabindex=-1 role="dialog">
				<div class="modal-dialog">
				<!-- Modal content-->
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Subject: {{task.msg_subject}}</h4>
						</div>
						<div class="modal-body">
							<p>{{task.msg_data|linebreaks}}</p>
						</div>
					</div>
				</div>
			</div><!-- Modal -->
			{% endfor %}
		</div><!-- Task container -->


	<div id="list-container" >	
		<ul id="parent-per-list" class="parent-list-nav nav nav-pills nav-justified">
	 		<li id="both" class="parent-active"><a style="border-radius:0px;" href="#">Both</a></li>
			<li id="modr"><a style="border-radius:0px;" href="#">Moderations</a></li>
			<li id="subr"><a style="border-radius:0px;" href="#">Subscriptions</a></li>
		</ul>	
		<div style="height:92%;" class="well" id="list-view">
			{% regroup tasks|dictsort:"list_id" by list_id as listed_tasks %}
			{%for listed_object in listed_tasks %}
				<div class="panel panel-default">
					<div style="padding:1.7em;" class="panel-body panel_lists">
						{{ listed_object.grouper|capfirst }}
						<span style="background-color:#1976D2;float:right;" class="both-badge per-list-badge badge">{{listed_object.list|length}}</span>
						<span style="background-color:#1976D2;float:right;display:none;" class=" mod-badge per-list-badge badge">
							{% for each_list in lists%}{% if each_list.list_id == listed_object.grouper %}
							{{each_list.held|length}}
						</span>
						<span style="background-color:#1976D2;float:right;display:none;" class="sub-badge per-list-badge badge">
							{{each_list.requests|length}}
						</span>
					</div>	
					<div id="per-list-container-{{listed_object.grouper}}" class="dialog container" style="z-index:1;display:none;">
						<ul id="perlist-switcher-{{listed_object.grouper}}" class="nav nav-pills nav-justified per-list-nav">
							<li id="list-mod" class="active"><a  style="border-radius:0px;" href="#">Moderations
							<span  class="badge">{{each_list.held|length}}</span></a></li>
							<li id="list-sub"><a style="border-radius:0px;" href="#">Subscriptions
							<span class="badge">{{each_list.requests|length}}</span></a></li>
						</ul>
						<table id="list-moderations" class="table table-hover"> <thead></thead>
							<tbody>{% if each_list.held|length == 0 %}
							<tr><td>There Are No Moderations Pending At The Moment
							{% else %}
							{% for each in listed_object.list%}{% if each.task_type == 'moderation' %}
			 				{% if each.priority == -1 %}
								<tr style="background-color:#EFFAFE;border:1px solid #00BCD4;">
						 	{% elif each.priority == 0 %}
								<tr style="background-color:#DBE7FD;border:1px solid #0097A7;">
						 	{% elif each.priority == 1 %}
								<tr style="background-color:#9F84ED;border:1px solid #9C27B0;">
						 	{% else %}
								<tr>
							{% endif %}
							<td>
								<span style="float:left">{{each.user_email|capfirst}}</span>
								<div id="holoid" style="float:right;" class="btn-group btn-group-sm" role="group" >
									<a href="{% url 'handle_mod_task' listed_object.grouper each.task_id 'accept'%}" class="btn btn_{{each.priority}} btn-default">{% trans 'Accept' %}</a>
									<a href="{% url 'handle_mod_task' listed_object.grouper each.task_id 'defer' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Defer' %}</a>
									<a href="{% url 'handle_mod_task' listed_object.grouper each.task_id 'reject' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Reject' %}</a>
									<a href="{% url 'handle_mod_task' listed_object.grouper each.task_id 'discard' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Discard' %}</a>
								</div>
							</td>
							</tr>
							{% endif %}{% endfor %}
							{% endif %}
							</tbody>
						</table>
						<table id="list-subscriptions" style="display:none;" class="table table-hover"> <thead></thead>	
							<tbody>{% if each_list.requests|length == 0 %}
							<tr><td>There Are No Pending Subscription Requests At The Moment
							{% else %}
							{% for each in listed_object.list%}{% if each.task_type == 'subscription' %}
			 				{% if each.priority == -1 %}
								<tr style="background-color:#EFFAFE;border:1px solid #00BCD4;">
						 	{% elif each.priority == 0 %}
								<tr style="background-color:#DBE7FD;border:1px solid #0097A7;">
						 	{% elif each.priority == 1 %}
								<tr style="background-color:#9F84ED;border:1px solid #9C27B0;">
						 	{% else %}
								<tr>
							{% endif %}
							<td>
								<span style="float:left">{{each.user_email|capfirst}}</span>
								<div id="holoid" style="float:right;" class="btn-group btn-group-sm" role="group">
									<a href="{% url 'handle_sub_task' listed_object.grouper each.task_id 'accept' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Accept' %}</a>
									<a href="{% url 'handle_sub_task' listed_object.grouper each.task_id 'reject' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Reject' %}</a>
			                			        <a href="{% url 'handle_sub_task' listed_object.grouper each.task_id 'discard' %}" class="btn btn_{{each.priority}} btn-default">{% trans 'Discard' %}</a>
								</div>
							</td>
							</tr>
							{% endif %}{% endfor %}
							{% endif %}
							</tbody>
						</table>{% endif %}{% endfor %}
					</div>
				</div>
			{% endfor %}
		</div>
	</div><!-- list container -->

	<div id="reorder" class="col-xs-4" style="width:100%;height:3.2em;padding-top:0.8em;"><span >Reorder</span>
		<div style="float:right;" class="btn-group">
			<span class="fa fa-lg fa-bars dropdown-toggle" data-toggle="dropdown" area-expanded="false" ></span>
			<span class="sr-only">Reorder Tasks</span>
			<ul class="dropdown-menu" role="menu">
				<li role="presentation" class="dropdown-header">Reorder By</li>
				<li role="presentation" ><a class="menuitem" href="{% url 'reorder_tasks_by' 'priority' %}">Priority</a></li>
				<li role="presentation" ><a class="menuitem" href="{% url 'reorder_tasks_by' 'task_type' %}">Task Type</a></li>
				<li role="presentation" ><a class="menuitem" href="{% url 'reorder_tasks_by' 'made_on' %}">Date Added</a></li>
			</ul>
		</div>			
	</div>

</div>



<div style="width:22%;float:right;height:70%;display:inline-block;margin-top:8%;border:1px solid;margin-right:3%;" class="widget container">
	<table class="table table-striped">
		<div style="text-align:center;" colspan="2">
			<h3 style="display:inline-block;">List Index</h3>
			<div style="margin-top:3%;float:right;width:40%;margin-right:5%;" class="input-group">
	            <span class="input-group-btn"><button class="btn btn-default fa fa-search" type="button"></button></span>
				<input type="text" placeholder="Search" class="form-control" id="index-search"></input>
			</div>
		</div>
	<thead></thead>
	<tbody>
		{% for list in lists %}
		<tr class="members-expand">
			<td style="padding:1.5em;">{{list.display_name}}</td>
			<td style="padding:1.5em;padding-right:2em;text-align:right;">
				<div class="btn-group btn-group-sm" role="group">
					<a href="{% url 'list_summary' list.list_id %}" class="btn btn-default">{% trans 'Actions' %}</a>
					<a href="{% url 'list_settings' list.list_id %}" class="btn btn-default">{% trans 'Configure' %}</a>
				</div>

				<div id="members_{{list.list_id}}" class="members-box dialog container" style="display:none;z-index:1;width:23%;height:25%">
					<ul style="border-radius:0px;" id="role-switcher-{{list.list_id}}" class="nav nav-justified role-nav">
						<li style="background-color:#FF5D56;" id="role-owners"><a href="#">Owners</a></li>	
						<li style="background-color:#FFF67F" id="role-moderators"><a href="#">Moderators</a></li>
						<li id="role-subscribers" class="active"><a href="#">Subscribers</a></li>
					</ul>
					<table style="display:none;" id="list-owners" class="table table-hover"> <thead></thead>
						<tbody>
						{% if list.owners|length_is:"0" %}
						<tr><td>There are no Owners currently for this list</td></tr>
						{% endif %}
						{% for each_owner in list.owners %}
						<tr>
							<td>	
								<span style="float:left">{{each_owner|capfirst}}</span>
								<div style="float:right;"class="btn-group btn-group-sm remove-role" role="group" >
									<a href="{% url 'remove_role_tasks' list.list_id 'owner' each_owner %}" class="btn btn-default remove">{% trans 'Remove' %}</a>
								</div>
							</td>
						</tr>
						{% endfor %}
						</tbody>
					</table>
					<table style="display:none;" id="list-moderators" class="table table-hover"> <thead></thead>
						<tbody>
						{% if list.moderators|length_is:"0" %}
						<tr><td>There are no Moderators currently for this list</td></tr>
						{% endif %}
						{% for each_mod in list.moderators %}
						<tr>
							<td>
							<span style="float:left">{{each_mod|capfirst}}</span>
							<div style="float:right;" class="btn-group btn-group-sm remove-role" role="group" >
								<a href="{% url 'remove_role_tasks' list.list_id 'moderator' each_mod %}" class="btn btn-default remove">{% trans 'Remove' %}</a>
							</div>
							</td>
						</tr>
						{% endfor %}
						</tbody>
					</table>
					<table id="list-subscribers" class="table table-hover"> <thead></thead>
						<tbody>
						{% if list.members|length_is:"0" %}
						<tr><td>None members are subscribed to the List currently</td></tr>
						{% endif %}
						{% for each_member in list.members %}
						
						{% for each_mod in list.moderators %}
						{% if each_member.email == each_mod %}
						<tr style="border:1.5px solid #FFC107;" bgcolor="#FFF67F">
						{% else %}
						<tr>
						{% endif %}
						{% endfor %}
						
						{% for each_own in list.owners %}
						{% if each_member.email == each_own %}
						<tr style="border:1.5px solid #D32F2F;" bgcolor="#FF5D56">
						{% endif %}
						{% endfor %}
						
						<td>
							<span style="float:left">{{each_member.email|capfirst}}</span>
							<div style="float:right;"class="btn-group btn-group-sm remove-role" role="group" >
								<a href="{% url 'list_member_options' list.fqdn_listname each_member.email %}" class="btn btn-default">{% trans 'View' %}</a>
								<a href="{% url 'remove_role_tasks' list.list_id 'subscriber' each_member.email %}" class="btn btn-default remove">{% trans 'Remove' %}</a>
							</div>
						</td>
						</tr>
						{% endfor %}
						</tbody>
					</table>
				</div>
			</td>
		</tr>
		{% endfor %}
	</tbody>
	</table>
</div>


<div style="width:15%;float:left;display:inline-block;height:100%;margin-top:8%; border:1px solid;margin-left:3%;" class="widget container">
	<div style="text-align:center;">
		<h3 style="display:inline-block;">Events Stream</h3>
	</div>
<div style="overflow-y:auto;height:92%;" class="activities">
	{% if events|length == 0 %}<hr />
	No new Recent Stories found
	{% else %}
	<table class="table" style=";padding-left:0.2em;"><thead></thead>
		<tbody>
			{% for each_event in events %}
			<tr>
				<td><span class="fa fa-shield fa-rotate-270"></td>
				<td>{{ each_event }}<br /><small class="text-muted" style="float:right;">{{each_event.made_on}}</small></td>
			</tr>
		</body>
	{% endfor %}
	</table>
	{% endif %}</div>
</div>

<div class="container widget" style="margin-left:23%;height:22%;margin-top:5%;width:75%;">
	<div style="display:inline-block;margin-left:3%;"><select id="select-list" multiple="multiple">
		{% for each in lists %}
   		<option value="{{each.list_id}}" selected="selected">{{each.display_name}}{% endfor %}
	</select>  </div>
		<div style="width:100%;height:100%;" class="ct-chart ct-golden-section">
		</div>

</div>


<script>
$(document).ready(function() {
	$('[name="query_field"]').attr("list","global-result");
	$("#id_query_field").on('input', function(){
		$("#global-search-form").submit();
		var val = this.value;
		$('#global-result option').each(function(){
			if (this.value === val){
				if ($(this).attr("id") == "list_option"){
					window.location = "/postorius/lists/" + $(this).attr("label");
				}
				else if ($(this).attr("id") == "people_option"){
					window.location = "/postorius/lists/" + $(this).attr("label") + "/members";
				}
				else if ($(this).attr("id") == "domain_option"){
					window.location = "/postorius/domains";
				}
			}
		}); 
	});
	$("#global-search-form").submit(function() {
		var myCheckboxes = new Array();
		$("input:checked").each(function() {
			myCheckboxes.push($(this).val());
		});
		$.ajax({
			type: "POST",
			url: "{% url 'user_dashboard' %}",
			data: $(this).serialize(),
			success: function(response){
				$("#global-result").empty();
				for (each in response.lists){
					var id = response.lists[each].list_id
					$("#global-result").append("<option id='list_option' value='" + response.lists[each].display_name + "' label='" + response.lists[each].list_id + "'>");
				}
				for (each in response.people){
					$("#global-result").append("<option id='people_option' value='" + response.people[each].useremail + "' label='" + response.people[each].list_id + "'>");
				}
				for (each in response.domains){
					$("#global-result").append("<option id='domain_option' value='" + response.domains[each].mail_host + "' label='" + response.domains[each].base_url + "'>");
				}
			}
		});
		return false;
	});
});

$(document).ready(function() {
		$('#select-list').multiselect({
onChange: function(option, checked, select) {

var lists = []
$('#select-list option:selected').each(function(idx, val){lists.push(val.value);});	

var dates = [];
{% regroup stats|dictsort:"on_date" by on_date as dated_stats %}{% for each in dated_stats|dictsort:"grouper" %}
dates.push("{{each.grouper|date:"Y-m-d"}}");{% endfor %}
dates = dates.sort();

var stat = [];
{% for each in stats|dictsort:"on_date" %}
stat.push({on_date: "{{each.on_date|date:"Y-m-d"}}", log_type: "{{each.log_type}}", log_number: "{{each.log_number}}", list_id: "{{each.list_id}}"});{% endfor %}

var subs = [];
var mods = [];
for (each in stat){
	
	if (stat[each].log_type == 'subscription'){
		if (lists.indexOf(stat[each].list_id) >=0 || stat[each].list_id == ""){
		subs.push(stat[each].log_number);
		}
		else if (lists.indexOf(stat[each].list_id) <0){
		subs.push("0");
		}
	}
	else if (stat[each].log_type == 'moderation'){
		if (lists.indexOf(stat[each].list_id) >=0 || stat[each].list_id == ""){
		mods.push(stat[each].log_number);
		}
		else if (lists.indexOf(stat[each].list_id) <0){
		mods.push("0");
		}
	}
}
new Chartist.Line('.ct-chart', {
	labels: dates,
	series: [
	{
		name: 'Subscription Requests',
		data: subs
	
	},
	{
		name: 'Moderation Requests',
		data: mods
	}]
});
}});
		});
var dates = [];
{% regroup stats|dictsort:"on_date" by on_date as dated_stats %}{% for each in dated_stats %}dates.push("{{each.grouper|date:"Y-m-d"}}");{% endfor %}

dates = dates.sort()
var chart = new Chartist.Line('.ct-chart', {
	labels: dates,
	series: [
	{
		name: 'Moderation Requests',
		data: [{% for each in stats|dictsort:"on_date" %}{% if each.log_type == 'moderation' %}"{{each.log_number}}",{% endif %}{% endfor %}]
	
	},
	{
		name: 'Subscription Requests',
		data: [{% for each in stats|dictsort:"on_date" %}{% if each.log_type == 'subscription' %}"{{each.log_number}}",{% endif %}{% endfor %}]
		}]
		}, {
			low: 0,
			axisX: {
				offset: 25,
				labelOffset: { y: 10 }
				},
			axisY: {
				offset: 35,
				labelOffset: { x: -10,y: 3 }
				}
		});


var $tooltip = $('<div class="tooltip tooltip-hidden"></div>').appendTo($('.ct-chart'));
 
$(document).on('mouseenter', '.ct-point', function() {
		  var seriesName = $(this).closest('.ct-series').attr('ct:series-name'),
		        value = $(this).attr('ct:value');
			  
			  $tooltip.text(seriesName + ': ' + value);
			    $tooltip.removeClass('tooltip-hidden');
			    });

$(document).on('mouseleave', '.ct-point', function() {
		  $tooltip.addClass('tooltip-hidden');
		  });

$(document).on('mousemove', '.ct-point', function(event) {
		    $tooltip.css({
			        left: (event.offsetX || event.originalEvent.layerX) - $tooltip.width() / 2,
				    top: (event.offsetY || event.originalEvent.layerY) - $tooltip.height() - 20
				      });
		    });

$("#switcher a").on("click", function(){
	$(".nav").find(".active").removeClass("active");
	$(this).parent().addClass("active");
	var id = $(".nav").find(".active").children().attr("id");
	if (id == 'list-view'){
		$("#task-container").hide("fast");
		$("#reorder").hide("fast");
		$("#list-container").show("fast");
	}
	else if (id == 'task-view'){
		$("#list-container").hide("fast");
		$("#reorder").show("fast");
		$("#task-container").show("fast");
	}
});
$("#parent-per-list a").on("click", function(){
	$(".parent-list-nav").find(".parent-active").removeClass("parent-active");
	$(this).parent().addClass("parent-active");
	var mod_badges = $(".mod-badge");
	var sub_badges = $(".sub-badge");
	var both_badges = $(".both-badge");

	$(".panel_lists").hide();
	var badge_id = $("#parent-per-list").find(".parent-active").attr("id");
	if (badge_id == 'both'){
		mod_badges.each(function(){$(this).hide();});
		sub_badges.each(function(){$(this).hide();});
		both_badges.each(function(){$(this).show();});
	}
	else if (badge_id == 'modr'){
		mod_badges.each(function(){$(this).show();});
		sub_badges.each(function(){$(this).hide();});
		both_badges.each(function(){$(this).hide();});

	}
	if (badge_id == 'subr'){
		mod_badges.each(function(){$(this).hide();});
		sub_badges.each(function(){$(this).show();});
		both_badges.each(function(){$(this).hide();});
	}
	$(".panel_lists").fadeIn();
});
$(".per-list-nav a").on("click", function(){
	var parent_ul = $(this).parents('ul.per-list-nav').children('.active').removeClass("active");
	$(this).parents('li').addClass("active");
	var id = $(this).parents('ul.per-list-nav').children('.active').attr("id");
	var par = $(this).parents('.dialog');
	if (id == 'list-mod'){
		$(par).children('#list-subscriptions').hide("fast");
		$(par).children('#list-moderations').show("fast");
	}
	else if (id == 'list-sub'){
		$(par).children('#list-subscriptions').show("fast");
		$(par).children('#list-moderations').hide("fast");
	}
});
$(".role-nav a").on("click", function(){
	var parent_ul = $(this).parents('ul.role-nav').children('.active').removeClass("active");
	$(this).parents('li').addClass("active");
	var id = $(this).parents('ul.role-nav').children('.active').attr("id");
	var par = $(this).parents('.dialog');
	if (id == 'role-moderators'){
		$(par).children('#list-owners').hide("fast");
		$(par).children('#list-subscribers').hide("fast");
		$(par).children('#list-moderators').show("fast");
	}
	else if (id == 'role-owners'){
		$(par).children('#list-moderators').hide("fast");
		$(par).children('#list-owners').show("fast");
		$(par).children('#list-subscribers').hide("fast");
	}
	else if (id == 'role-subscribers'){
		$(par).children('#list-owners').hide("fast");
		$(par).children('#list-subscribers').show("fast");
		$(par).children('#list-moderators').hide("fast");
	}
});
$(".panel_lists").on("click", function(){
	var d_id = $(this).parent().children('.dialog').attr("id")
	var all_boxes = $('.dialog');
	the_box = $.grep(all_boxes, function(e){ return e.id==d_id})[0];
	if ($(this).hasClass('active')){
    		$(the_box).fadeOut(200);
        	$(this).removeClass('active');
	  } 
	else {
		var id = $("#parent-per-list").find(".parent-active").attr("id");
		$(".panel_lists").parent().children(".dialog").each(function(){$(this).hide();});
		$(".panel_lists").parent().find('.active').each(function(){$(this).removeClass('active');});

		if (id == 'modr'){
		$(the_box).find(".per-list-nav").hide();
		$(the_box).find("#list-subscriptions").hide();
		$(the_box).find("#list-moderations").show();
		}
		else if (id == 'subr'){
			$(the_box).find(".per-list-nav").hide();
			$(the_box).find("#list-subscriptions").show();
			$(the_box).find("#list-moderations").hide();
		}
		else {
			$(the_box).find(".per-list-nav").show();
			var active_tab = $(the_box).find(".per-list-nav").children('.active').attr("id")
			if (!active_tab){
				$(the_box).find("#list-subscriptions").hide();
				$(the_box).find("#list-moderations").show();
			}
			else if (active_tab == 'list-mod'){
				$(the_box).find("#list-subscriptions").hide();
				$(the_box).find("#list-moderations").show();
			}
			else if (active_tab == 'list-sub'){
				$(the_box).find("#list-subscriptions").show();
				$(the_box).find("#list-moderations").hide();
			}
		}
	$(the_box).fadeIn(200);
	$(the_box).css({"display":"block","top":$(this).parent().position().top + $(this).parent().height(),"right":$(this).parent().width()});
	$(this).addClass('active');
	}
});

$(".members-expand").on("click", function(e){
	var target = e.target;
	var class_name = $(target).parent().attr("class");
	if (!class_name || class_name.includes('members-expand')){
		var d_id = $(this).find(".dialog").attr("id");
		var all_boxes = $('.dialog');
		the_box = $.grep(all_boxes, function(e){ return e.id==d_id})[0];
		if ($(this).hasClass('active')){
			$(the_box).fadeOut(200);
			$(this).removeClass('active');
		} 
		else {
			$(".members-expand").find(".dialog").each(function(){$(this).hide();});
			$(this).parent().children('tr').each(function(){$(this).removeClass('active');});
			$(the_box).fadeIn(200);
		  	$(the_box).css({"display":"block","top":$(this).position().top + $(this).height(),"left": $(this).position().left - $(this).width()/7})
			$(this).addClass('active');  
		}
	}
});

$('.remove-role .remove').click(function(){
	return false;
});

$('.remove-role .remove').dblclick(function(){
	var href = $(this).attr("href");
	window.location = href;
});
</script>
</body>
</html>
{# endblock main #}
